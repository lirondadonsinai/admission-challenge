<!DOCTYPE html>
<html>
<head>
    <title>SIM Inventory</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        button { padding: 6px 12px; margin: 4px; }
        .payload {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            background: #f9f9f9;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .meta {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>

<h2>SIM Inventory History</h2>

<label>SIM Number:</label>
<input type="number" id="simNum" value="1" />

<label>Page size:</label>
<input type="number" id="pageSize" value="5" min="1" max="50" />

<button onclick="loadData()">Load</button>

<p id="status"></p>

<div id="results"></div>

<div>
    <button onclick="prevPage()">Previous</button>
    <button onclick="nextPage()">Next</button>
</div>

<script>
    let page = 1;

    async function loadData() {
        const simNum = document.getElementById("simNum").value;
        const pageSize = document.getElementById("pageSize").value;
        const status = document.getElementById("status");
        const results = document.getElementById("results");

        status.innerText = "Loading...";
        results.innerHTML = "";

        const start = performance.now();

        const res = await fetch(
            `/api/slow?sim_num=${simNum}&page=${page}&page_size=${pageSize}`
        );
        const data = await res.json();

        const duration = (performance.now() - start).toFixed(2);
        status.innerText = `Page ${page} | Response time: ${duration} ms`;

        if (data.items.length === 0) {
            results.innerHTML = "<p>No results</p>";
            return;
        }

        data.items.forEach(item => {
            const div = document.createElement("div");
            div.className = "payload";
            div.innerHTML = `
              <div class="meta">${item.created_at}</div>
              ${item.payload}
            `;
            results.appendChild(div);
        });
    }

    function nextPage() {
        page++;
        loadData();
    }

    function prevPage() {
        if (page > 1) {
            page--;
            loadData();
        }
    }
</script>

</body>
</html>
